<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Trading Bots - Training Visualization</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/neataptic/1.4.6/neataptic.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-gap: 20px;
        }
        .bot-container {
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
        }
        .chart {
            width: 100%;
            height: 300px;
        }
        .info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<!-- Hiển thị các bot giao dịch -->
<div id="bot0" class="bot-container">
    <div class="chart" id="chart0"></div>
    <div class="info">
        <p>Bot 1 Balance: <span id="balance0">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned0">0 BTC</span></p>
    </div>
</div>

<div id="bot1" class="bot-container">
    <div class="chart" id="chart1"></div>
    <div class="info">
        <p>Bot 2 Balance: <span id="balance1">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned1">0 BTC</span></p>
    </div>
</div>

<div id="bot2" class="bot-container">
    <div class="chart" id="chart2"></div>
    <div class="info">
        <p>Bot 3 Balance: <span id="balance2">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned2">0 BTC</span></p>
    </div>
</div>

<div id="bot3" class="bot-container">
    <div class="chart" id="chart3"></div>
    <div class="info">
        <p>Bot 4 Balance: <span id="balance3">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned3">0 BTC</span></p>
    </div>
</div>

<div id="bot4" class="bot-container">
    <div class="chart" id="chart4"></div>
    <div class="info">
        <p>Bot 5 Balance: <span id="balance4">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned4">0 BTC</span></p>
    </div>
</div>

<div id="bot5" class="bot-container">
    <div class="chart" id="chart5"></div>
    <div class="info">
        <p>Bot 6 Balance: <span id="balance5">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned5">0 BTC</span></p>
    </div>
</div>

<div id="bot6" class="bot-container">
    <div class="chart" id="chart6"></div>
    <div class="info">
        <p>Bot 7 Balance: <span id="balance6">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned6">0 BTC</span></p>
    </div>
</div>

<div id="bot7" class="bot-container">
    <div class="chart" id="chart7"></div>
    <div class="info">
        <p>Bot 8 Balance: <span id="balance7">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned7">0 BTC</span></p>
    </div>
</div>

<div id="bot8" class="bot-container">
    <div class="chart" id="chart8"></div>
    <div class="info">
        <p>Bot 9 Balance: <span id="balance8">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned8">0 BTC</span></p>
    </div>
</div>

<div id="bot9" class="bot-container">
    <div class="chart" id="chart9"></div>
    <div class="info">
        <p>Bot 10 Balance: <span id="balance9">$10000</span></p>
        <p>Bitcoin Owned: <span id="bitcoinOwned9">0 BTC</span></p>
    </div>
</div>

<script>
    // Số lượng bot
    const NUM_BOTS = 10;
    const charts = [];
    const candlestickSeries = [];

    // Tạo biểu đồ cho mỗi bot
    for (let i = 0; i < NUM_BOTS; i++) {
        charts[i] = LightweightCharts.createChart(document.getElementById(`chart${i}`), {
            width: document.getElementById(`chart${i}`).clientWidth,
            height: 300,
            layout: {
                backgroundColor: '#ffffff',
                textColor: '#000000',
            },
            grid: {
                vertLines: {
                    color: '#e1e1e1',
                },
                horzLines: {
                    color: '#e1e1e1',
                },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
            rightPriceScale: {
                borderColor: '#d1d4dc',
            },
            timeScale: {
                borderColor: '#d1d4dc',
                timeVisible: true,
            },
        });

        // Thêm candlestick series cho mỗi biểu đồ
        candlestickSeries[i] = charts[i].addCandlestickSeries();
    }

    // Tạo WebSocket để nhận dữ liệu giao dịch
    const socket = new WebSocket(`ws://${window.location.host}`);
    let data = [];

    // Trạng thái của bot
    let botStates = Array(NUM_BOTS).fill().map(() => ({
        balance: 10000,
        bitcoinOwned: 0,
        purchasePrice: null
    }));

    // Cập nhật hiển thị thông tin cho từng bot
    function updateBotInfo(botIndex) {
        document.getElementById(`balance${botIndex}`).textContent = `$${botStates[botIndex].balance.toFixed(2)}`;
        document.getElementById(`bitcoinOwned${botIndex}`).textContent = `${botStates[botIndex].bitcoinOwned.toFixed(4)} BTC`;
    }

    // Kết nối WebSocket và xử lý dữ liệu nến
    socket.onmessage = function (event) {
        const message = JSON.parse(event.data);

        if (message.open && message.high && message.low && message.close) {
            const time = Math.floor(message.time / 1000); // Chuyển đổi timestamp thành giây

            // Thêm dữ liệu nến cho tất cả các bot
            data.push({
                time: time,
                open: message.open,
                high: message.high,
                low: message.low,
                close: message.close
            });

            for (let i = 0; i < NUM_BOTS; i++) {
                candlestickSeries[i].setData(data);

                // Đơn giản hóa giao dịch: bot sẽ mua 1% số dư hoặc bán toàn bộ BTC nếu giá tăng 1%
                if (botStates[i].balance > 0 && botStates[i].bitcoinOwned === 0) {
                    const buyAmountInUSD = botStates[i].balance * 0.01;
                    const buyAmountInBTC = buyAmountInUSD / message.close;
                    botStates[i].bitcoinOwned += buyAmountInBTC;
                    botStates[i].balance -= buyAmountInUSD;
                    botStates[i].purchasePrice = message.close;
                    console.log(`Bot ${i} mua ${buyAmountInBTC.toFixed(4)} BTC với giá ${message.close}`);
                } else if (botStates[i].bitcoinOwned > 0 && message.close >= botStates[i].purchasePrice * 1.01) {
                    const sellAmountInUSD = botStates[i].bitcoinOwned * message.close;
                    botStates[i].balance += sellAmountInUSD;
                    botStates[i].bitcoinOwned = 0;
                    botStates[i].purchasePrice = null;
                    console.log(`Bot ${i} bán ${sellAmountInUSD.toFixed(2)} USD với giá ${message.close}`);
                }

                // Cập nhật thông tin hiển thị cho bot
                updateBotInfo(i);
            }
        }
    };

    // Khi WebSocket kết nối thành công
    socket.onopen = function () {
        console.log('WebSocket connection established');
    };

    // Khi WebSocket bị ngắt kết nối
    socket.onclose = function () {
        console.log('WebSocket connection closed');
    };

    // Khi có lỗi WebSocket
    socket.onerror = function (error) {
        console.error('WebSocket error:', error);
    };
</script>

</body>
</html>
